<nz-spin [nzSpinning]='loadingRecords'>
    <div
        style="border-radius: 8px; background-color: white; padding: 10px; margin: 10px; position: sticky; top: 0px; z-index: 10;">
        <div nz-row>
            <div nz-col nzXs="0" nzSm="0" nzMd="16" nzLg="16" nzXl="16">
                <div style="text-align: left; padding: 5px;">
                    <span class="formname">
                        {{formTitle}}
                    </span>
                </div>
            </div>

            <div nz-col nzXs="0" nzSm="0" nzMd="8" nzLg="8" nzXl="8" style="text-align: right;">
                <nz-input-group [nzSuffix]="suffixIcon" [nzPrefix]="prefixIcon">
                    <input nz-input type="text" name="search" autocomplete="off" placeholder="Search Here.."
                        (keydown.enter)="addSearchTextForSearching(searchText)" [(ngModel)]="searchText" />
                </nz-input-group>

                <ng-template #prefixIcon>
                    <span nz-icon nzType="search"></span>
                </ng-template>

                <ng-template #suffixIcon>
                    <i nz-icon nzType="filter" nzTheme="outline" (click)="openAdvanceFilter()"
                        nzTooltipTitle="Advance Filter" nzTooltipPlacement="top" nz-tooltip>
                    </i>
                </ng-template>
            </div>

            <div nz-col nzXs="12" nzSm="12" nzMd="0" nzLg="0" nzXl="0">
                <div style="text-align: left; padding: 5px;">
                    <span class="formname">
                        {{formTitle}}
                    </span>
                </div>
            </div>

            <div nz-col nzXs="12" nzSm="12" nzMd="0" nzLg="0" nzXl="0" style="text-align: right;">
                <nz-input-group [nzSuffix]="suffixIcon" [nzPrefix]="prefixIcon">
                    <input nz-input type="text" name="search" autocomplete="off" placeholder="Search Here.."
                        (keydown.enter)="addSearchTextForSearching(searchText)" [(ngModel)]="searchText" />
                </nz-input-group>

                <ng-template #prefixIcon>
                    <span nz-icon nzType="search"></span>
                </ng-template>

                <ng-template #suffixIcon>
                    <i nz-icon nzType="filter" nzTheme="outline" (click)="openAdvanceFilter()"
                        nzTooltipTitle="Advance Filter" nzTooltipPlacement="top" nz-tooltip>
                    </i>
                </ng-template>
            </div>
        </div>
    </div>

    <div *ngIf="advanceFilterModalVisible"
        style="border-radius: 8px; background-color: white; padding: 10px; margin: 10px; position: sticky; top: 0px; z-index: 10;">
        <div style="max-height: 250px; overflow: auto;">
            <div nz-row>
                <div nz-col nzXs="12" nzSm="12" nzMd="8" nzLg="8" nzXl="8">
                    <nz-form-item>
                        <nz-form-label nzNoColon>From Date</nz-form-label>

                        <nz-form-control>
                            <nz-date-picker name="fromDate" [nzDisabledDate]="disabledDate" nzFormat="dd/MM/yyyy"
                                (ngModelChange)="onFromDateChange($event)" [(ngModel)]="ADVANCE_FILTER_FROM_DATE">
                            </nz-date-picker>
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <div nz-col nzXs="12" nzSm="12" nzMd="8" nzLg="8" nzXl="8">
                    <nz-form-item>
                        <nz-form-label nzNoColon>To Date</nz-form-label>

                        <nz-form-control>
                            <nz-date-picker name="toDate" [nzDisabledDate]="disabledToDate" nzFormat="dd/MM/yyyy"
                                [(ngModel)]="ADVANCE_FILTER_TO_DATE">
                            </nz-date-picker>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>

            <div nz-row>
                <div nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="12">
                    <nz-form-item>
                        <nz-form-label nzNoColon>Federation(s)</nz-form-label>

                        <nz-form-control>
                            <nz-select name="federation" [nzMaxTagCount]="3" nzShowSearch nzMode="multiple" nzAllowClear
                                style="width: 100%" nzPlaceHolder="Select Federation(s)" [(ngModel)]="FEDERATION_ID">

                                <nz-option *ngFor="let federation of federations;" [nzValue]="federation.NAME"
                                    [nzLabel]="federation.NAME">
                                </nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <div nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="12">
                    <nz-form-item>
                        <nz-form-label nzNoColon>Unit(s)</nz-form-label>

                        <nz-form-control>
                            <nz-select name="unit" [nzMaxTagCount]="3" [nzSuffixIcon]="suffixIcon" nzShowSearch
                                nzServerSearch nzMode="multiple" nzAllowClear style="width: 100%"
                                nzPlaceHolder="Type here to search" [(ngModel)]="UNIT_ID"
                                (nzOnSearch)="getUnits($event)">

                                <nz-option nzCustomContent *ngFor="let unit of units;" [nzValue]="unit.NAME"
                                    [nzLabel]="unit.NAME">
                                    <div nz-row>
                                        <div nz-col nzSpan="24">
                                            {{unit.NAME}}
                                        </div>

                                        <div nz-col nzSpan="24">
                                            <div style="font-size: 10px; color: gray;">
                                                <i nz-icon nzType="global" nzTheme="outline" style="color: #ff8d73;">
                                                </i>

                                                {{unit.FEDERATION_NAME}}
                                            </div>
                                        </div>
                                    </div>
                                </nz-option>
                            </nz-select>

                            <ng-template #suffixIcon>
                                <div style="cursor: pointer;">
                                    <span nz-popover nzPopoverTitle="Info" [nzPopoverContent]="contentTemplate"
                                        nzPopoverPlacement="top"
                                        style="font-size: 17px; font-weight: bold; font-family: Georgia, 'Times New Roman', Times, serif;">
                                        i
                                    </span>
                                </div>

                                <ng-template #contentTemplate>
                                    <div>
                                        <p>Enter at least three characters to search</p>
                                    </div>
                                </ng-template>
                            </ng-template>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>

            <div nz-row>
                <div nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="12">
                    <nz-form-item>
                        <nz-form-label nzNoColon>Group(s)</nz-form-label>

                        <nz-form-control>
                            <nz-select name="group" [nzMaxTagCount]="3" [nzSuffixIcon]="suffixIcon" nzShowSearch
                                nzServerSearch nzMode="multiple" nzAllowClear style="width: 100%"
                                nzPlaceHolder="Type here to search" [(ngModel)]="GROUP_ID"
                                (nzOnSearch)="getGroups($event)">

                                <nz-option nzCustomContent *ngFor="let group of groups;" [nzValue]="group.NAME"
                                    [nzLabel]="group.NAME">
                                    <div nz-row>
                                        <div nz-col nzSpan="24">
                                            {{group.NAME}}
                                        </div>

                                        <div nz-col nzSpan="24">
                                            <div style="font-size: 10px; color: gray;">
                                                <i nz-icon nzType="global" nzTheme="outline" style="color: #ff8d73;">
                                                </i>

                                                {{group.FEDERATION_NAME}}
                                            </div>
                                        </div>

                                        <div nz-col nzSpan="24">
                                            <div style="font-size: 10px; color: gray;">
                                                <i nz-icon nzType="deployment-unit" nzTheme="outline"
                                                    style="color: #ff8d73;">
                                                </i>

                                                {{group.UNIT_NAME}}
                                            </div>
                                        </div>
                                    </div>
                                </nz-option>
                            </nz-select>

                            <ng-template #suffixIcon>
                                <div style="cursor: pointer;">
                                    <span nz-popover nzPopoverTitle="Info" [nzPopoverContent]="contentTemplate"
                                        nzPopoverPlacement="top"
                                        style="font-size: 17px; font-weight: bold; font-family: Georgia, 'Times New Roman', Times, serif;">
                                        i
                                    </span>
                                </div>

                                <ng-template #contentTemplate>
                                    <div>
                                        <p>Enter at least three characters to search</p>
                                    </div>
                                </ng-template>
                            </ng-template>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>

            <div nz-row>
                <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24" style="text-align: right;">
                    <button nz-button
                        style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff; margin-right: 3px;"
                        nzType="default" (click)="advanceFilterModalCancel()">
                        Cancel
                    </button>

                    <button nz-button
                        style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff; margin-right: 3px;"
                        nzType="default" (click)="clearAdvanceFilter()">
                        Clear
                    </button>

                    <button nz-button
                        style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff; margin-right: 3px;"
                        nzType="default" (click)="advanceFilterModalOk()">
                        Apply
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="(multipleSearchText.length > 0) || (advanceMultipleSearchText.length > 0) || (advanceMultipleFederationNames.length > 0) || (advanceMultipleUnitNames.length > 0) || (advanceMultipleGroupNames.length > 0)"
        style="height: 7vh; overflow-y: auto; border-radius: 8px; background-color: white; padding: 10px; margin: 10px; position: sticky; top: 0px; z-index: 10;">
        <div nz-row>
            <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24">
                <div style="padding: 3px 0px 3px 0px;">
                    <span *ngIf="multipleSearchText.length > 0">
                        <span *ngFor="let text of multipleSearchText; let i = index;">
                            <nz-tag [nzColor]="'magenta'" nzMode="closeable" (nzOnClose)="onClose(i)"
                                style="font-size: 10px; padding: 1px; margin: 1px;">
                                {{text}}
                            </nz-tag>
                        </span>
                    </span>

                    <span *ngIf="advanceMultipleSearchText.length > 0">
                        <span *ngFor="let text of advanceMultipleSearchText; let j = index;">
                            <nz-tag [nzColor]="'magenta'" nzMode="closeable" (nzOnClose)="onAdvanceFilterTagClose(j)"
                                style="font-size: 10px; padding: 1px; margin: 1px;">
                                {{text}}
                            </nz-tag>
                        </span>
                    </span>

                    <span *ngIf="advanceMultipleFederationNames.length > 0">
                        <span *ngFor="let text of advanceMultipleFederationNames; let l = index;">
                            <nz-tag [nzColor]="'magenta'" nzMode="closeable"
                                (nzOnClose)="onAdvanceFilterFederationNamesTagClose(l)"
                                style="font-size: 10px; padding: 1px; margin: 1px;">
                                {{text}}
                            </nz-tag>
                        </span>
                    </span>

                    <span *ngIf="advanceMultipleUnitNames.length > 0">
                        <span *ngFor="let text of advanceMultipleUnitNames; let m = index;">
                            <nz-tag [nzColor]="'magenta'" nzMode="closeable"
                                (nzOnClose)="onAdvanceFilterUnitNamesTagClose(m)"
                                style="font-size: 10px; padding: 1px; margin: 1px;">
                                {{text}}
                            </nz-tag>
                        </span>
                    </span>

                    <span *ngIf="advanceMultipleGroupNames.length > 0">
                        <span *ngFor="let text of advanceMultipleGroupNames; let n = index;">
                            <nz-tag [nzColor]="'magenta'" nzMode="closeable"
                                (nzOnClose)="onAdvanceFilterGroupNamesTagClose(n)"
                                style="font-size: 10px; padding: 1px; margin: 1px;">
                                {{text}}
                            </nz-tag>
                        </span>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="!advanceFilterModalVisible" id="activityItem" [ngStyle]="{ height: getHeigth() }"
        style="overflow-y: auto; padding: 10px;" (scroll)="onScroll($event)">
        <div *ngIf="dataList.length > 0">
            <div *ngFor="let data of dataList; let i = index;"
                style="border-radius: 8px; background-color: white; padding: 10px; margin-bottom: 10px;">
                <div nz-row>
                    <div nz-col nzSpan="20" style="font-size: 14px;">
                        <span style="color: #FF7A7A;">Group Name :</span>&nbsp;

                        <span style="color: black;">
                            {{data.GROUP_NAME}}
                        </span>
                    </div>

                    <div nz-col nzSpan="4" style="text-align: right; font-size: 10px;">
                        <i nz-icon nzType="calendar" nzTheme="outline" style="color: #FF7A7A;"></i>&nbsp;

                        <span style="color: black;">
                            {{data.DATE | date: 'dd MMM yy'}}
                        </span>
                    </div>
                </div>

                <div nz-row>
                    <div nz-col nzSpan="24" style="font-size: 12px; font-weight: bold; text-align: left;">
                        <span style="color: green;" *ngIf="data['PAYMENT_TYPE'] == 'R'">Renew</span>
                        <span style="color: green;" *ngIf="data['PAYMENT_TYPE'] == 'N'">New Membership</span>
                        <span style="color: green;" *ngIf="data['PAYMENT_TYPE'] == 'R,N'">Renew & New Membership </span>
                        <span style="color: green;" *ngIf="data['PAYMENT_TYPE'] == 'N,R'">New Membership & Renew</span>
                    </div>

                    <div nz-col nzSpan="12" style="font-size: 14px; text-align: left;">
                        <span style="color: #FF7A7A;">â‚¹ :</span>&nbsp;

                        <span>
                            {{data.AMOUNT}}

                            <span *ngIf="data.CHILD_GROUP_ID > 0">
                                + {{data.CHILD_GROUP_AMOUNT}} = {{data.AMOUNT + data.CHILD_GROUP_AMOUNT}}
                            </span>
                        </span>
                    </div>

                    <div nz-col nzSpan="12" style="font-size: 14px; text-align: right;">
                        <span style="color: #FF7A7A;">Reference No. :</span>&nbsp;

                        <span>
                            {{data.PAYMENT_REFERENCE_NO}}
                        </span>
                    </div>

                    <div nz-col nzSpan="24">
                        <div style="font-size: 14px; word-break: break-all; text-align: justify;">
                            <span style="color: #FF7A7A;">Narration :</span>&nbsp;

                            <span>
                                {{data.NARRATION}}
                            </span>
                        </div>
                    </div>
                </div>

                <div nz-row style="padding-top: 10px;">
                    <div nz-col nzSpan="8">
                        <div style="text-align: left;">
                            <button nz-button (click)="viewReceipt(data.FILE_URL)" nzType="default"
                                style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff;">View Receipt
                            </button>
                        </div>
                    </div>

                    <div nz-col nzSpan="8">
                        <div style="text-align: center;">
                            <button nz-button nz-popconfirm nzPopconfirmTitle="Are you sure, approve this payment?"
                                (nzOnConfirm)="paymentApproveReject(data,'A')" (nzOnCancel)="cancel()"
                                nzPopconfirmPlacement="top" nzType="default"
                                style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff;">
                                Approve
                            </button>

                            &nbsp;

                            <button nz-button nz-popconfirm nzPopconfirmTitle="Are you sure, reject this payment?"
                                (nzOnConfirm)="paymentApproveReject(data,'R')" (nzOnCancel)="cancel()"
                                nzPopconfirmPlacement="top" nzType="default"
                                style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff;">
                                Reject
                            </button>
                        </div>
                    </div>

                    <div nz-col nzSpan="8">
                        <div style="text-align: right;">
                            <button nz-button (click)="ViewDetails(data.ID)" nzType="default"
                                style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff;">Details
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div *ngIf="dataList.length == 0">
            <nz-empty
                [nzNotFoundImage]="'https://gw.alipayobjects.com/mdn/miniapp_social/afts/img/A*pevERLJC9v0AAAAAAAAAAABjAQAAAQ/original'"
                [nzNotFoundContent]="contentTpl">
            </nz-empty>

            <ng-template #contentTpl>
                <span>No data available.</span>
            </ng-template>
        </div>
    </div>
</nz-spin>

<nz-drawer [nzBodyStyle]="{ height: 'calc(100% - 60px)', overflow: 'auto', 'padding-bottom': '53px' }"
    [nzClosable]="false" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="800" [nzVisible]="drawerVisible4"
    [nzTitle]="drawerTitle4" (nzOnClose)="drawerClose4()" (nzKeyboard)="true">

    <app-memberspaymentdetails [drawerClose4]="closeCallback4" [drawerVisible4]="drawerVisible4"
        [paymentDataId]="dataId">
    </app-memberspaymentdetails>
</nz-drawer>