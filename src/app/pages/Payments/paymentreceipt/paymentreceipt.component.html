<nz-spin [nzSpinning]='loadingRecords'>
  <div
    style="border-radius: 8px; background-color: white; padding: 10px; margin: 10px; position: sticky; top: 0px; z-index: 10;">
    <div nz-row>
      <div nz-col nzXs="0" nzSm="0" nzMd="8" nzLg="8" nzXl="8">
        <div style="text-align: left; padding: 5px;">
          <span class="formname">
            <i nz-icon nzType="left-circle" nzTheme="outline" (click)="back()"></i>
            {{formTitle}}
          </span>
        </div>
      </div>

      <div nz-col nzXs="0" nzSm="0" nzMd="8" nzLg="8" nzXl="8">
        <div style="text-align: center;" *ngIf="(unitID > 0) || (groupID > 0)">
          <button nz-button nzType="default" style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff;"
            (click)="add()">
            <i nz-icon nzType="plus"></i>
            Payment
          </button>
        </div>
      </div>

      <div nz-col nzXs="0" nzSm="0" nzMd="8" nzLg="8" nzXl="8" style="text-align: right;">
        <nz-input-group [nzSuffix]="suffixIcon" [nzPrefix]="prefixIcon">
          <input nz-input type="text" name="search" autocomplete="off" placeholder="Search Here.."
            (keydown.enter)="addSearchTextForSearching(searchText)" [(ngModel)]="searchText" />
        </nz-input-group>

        <ng-template #prefixIcon>
          <span nz-icon nzType="search"></span>
        </ng-template>

        <ng-template #suffixIcon>
          <i nz-icon nzType="filter" nzTheme="outline" (click)="openAdvanceFilter()" nzTooltipTitle="Advance Filter"
            nzTooltipPlacement="top" nz-tooltip>
          </i>
        </ng-template>
      </div>

      <div nz-col nzXs="8" nzSm="8" nzMd="0" nzLg="0" nzXl="0">
        <div style="text-align: left; padding: 5px;">
          <span class="formname">
            {{formTitle}}
          </span>
        </div>
      </div>

      <div nz-col nzXs="16" nzSm="16" nzMd="0" nzLg="0" nzXl="0">
        <div style="text-align: right;">
          <nz-input-group [nzSuffix]="suffixIcon" [nzPrefix]="prefixIcon">
            <input nz-input type="text" name="search" autocomplete="off" placeholder="Search Here.."
              (keydown.enter)="addSearchTextForSearching(searchText)" [(ngModel)]="searchText" />
          </nz-input-group>

          <ng-template #prefixIcon>
            <span nz-icon nzType="search"></span>
          </ng-template>

          <ng-template #suffixIcon>
            <i nz-icon nzType="filter" nzTheme="outline" (click)="openAdvanceFilter()" nzTooltipTitle="Advance Filter"
              nzTooltipPlacement="top" nz-tooltip>
            </i>
          </ng-template>
        </div>
      </div>

      <div nz-col nzXs="24" nzSm="24" nzMd="0" nzLg="0" nzXl="0">
        <div style="text-align: center; padding-top: 10px;" *ngIf="(unitID > 0) || (groupID > 0)">
          <button nz-button nzType="default" style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff;"
            (click)="add()">
            <i nz-icon nzType="plus"></i>
            Payment
          </button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="advanceFilterModalVisible"
    style="border-radius: 8px; background-color: white; padding: 10px; margin: 10px; position: sticky; top: 0px; z-index: 10;">
    <div style="max-height: 250px; overflow: auto;">
      <div nz-row>
        <div nz-col nzXs="12" nzSm="12" nzMd="8" nzLg="8" nzXl="8">
          <nz-form-item>
            <nz-form-label nzNoColon>From Date</nz-form-label>

            <nz-form-control>
              <nz-date-picker name="fromDate" nzFormat="dd/MM/yyyy" (ngModelChange)="onFromDateChange($event)"
                [(ngModel)]="ADVANCE_FILTER_FROM_DATE">
              </nz-date-picker>
            </nz-form-control>
          </nz-form-item>
        </div>

        <div nz-col nzXs="12" nzSm="12" nzMd="8" nzLg="8" nzXl="8">
          <nz-form-item>
            <nz-form-label nzNoColon>To Date</nz-form-label>

            <nz-form-control>
              <nz-date-picker name="toDate" [nzDisabledDate]="disabledToDate" nzFormat="dd/MM/yyyy"
                [(ngModel)]="ADVANCE_FILTER_TO_DATE">
              </nz-date-picker>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>

      <div nz-row>
        <div nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="12">
          <nz-form-item>
            <nz-form-label nzNoColon>Federation(s)</nz-form-label>

            <nz-form-control>
              <nz-select name="federation" [nzMaxTagCount]="3" nzShowSearch nzMode="multiple" nzAllowClear
                style="width: 100%" nzPlaceHolder="Select Federation(s)" [(ngModel)]="FEDERATION_ID">

                <nz-option *ngFor="let federation of federations;" [nzValue]="federation.NAME"
                  [nzLabel]="federation.NAME">
                </nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>

        <div nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="12">
          <nz-form-item>
            <nz-form-label nzNoColon>Unit(s)</nz-form-label>

            <nz-form-control>
              <nz-select name="unit" [nzMaxTagCount]="3" [nzSuffixIcon]="suffixIcon" nzShowSearch nzServerSearch
                nzMode="multiple" nzAllowClear style="width: 100%" nzPlaceHolder="Type here to search"
                [(ngModel)]="UNIT_ID" (nzOnSearch)="getUnits($event)">

                <nz-option nzCustomContent *ngFor="let unit of units;" [nzValue]="unit.NAME" [nzLabel]="unit.NAME">
                  <div nz-row>
                    <div nz-col nzSpan="24">
                      {{unit.NAME}}
                    </div>

                    <div nz-col nzSpan="24">
                      <div style="font-size: 10px; color: gray;">
                        <i nz-icon nzType="global" nzTheme="outline" style="color: #ff8d73;">
                        </i>

                        {{unit.FEDERATION_NAME}}
                      </div>
                    </div>
                  </div>
                </nz-option>
              </nz-select>

              <ng-template #suffixIcon>
                <div style="cursor: pointer;">
                  <span nz-popover nzPopoverTitle="Info" [nzPopoverContent]="contentTemplate" nzPopoverPlacement="top"
                    style="font-size: 17px; font-weight: bold; font-family: Georgia, 'Times New Roman', Times, serif;">
                    i
                  </span>
                </div>

                <ng-template #contentTemplate>
                  <div>
                    <p>Enter at least three characters to search</p>
                  </div>
                </ng-template>
              </ng-template>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>

      <div nz-row>
        <div nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="12">
          <nz-form-item>
            <nz-form-label nzNoColon>Group(s)</nz-form-label>

            <nz-form-control>
              <nz-select name="group" [nzMaxTagCount]="3" [nzSuffixIcon]="suffixIcon" nzShowSearch nzServerSearch
                nzMode="multiple" nzAllowClear style="width: 100%" nzPlaceHolder="Type here to search"
                [(ngModel)]="GROUP_ID" (nzOnSearch)="getGroups($event)">

                <nz-option nzCustomContent *ngFor="let group of groups;" [nzValue]="group.NAME" [nzLabel]="group.NAME">
                  <div nz-row>
                    <div nz-col nzSpan="24">
                      {{group.NAME}}
                    </div>

                    <div nz-col nzSpan="24">
                      <div style="font-size: 10px; color: gray;">
                        <i nz-icon nzType="global" nzTheme="outline" style="color: #ff8d73;">
                        </i>

                        {{group.FEDERATION_NAME}}
                      </div>
                    </div>

                    <div nz-col nzSpan="24">
                      <div style="font-size: 10px; color: gray;">
                        <i nz-icon nzType="deployment-unit" nzTheme="outline" style="color: #ff8d73;">
                        </i>

                        {{group.UNIT_NAME}}
                      </div>
                    </div>
                  </div>
                </nz-option>
              </nz-select>

              <ng-template #suffixIcon>
                <div style="cursor: pointer;">
                  <span nz-popover nzPopoverTitle="Info" [nzPopoverContent]="contentTemplate" nzPopoverPlacement="top"
                    style="font-size: 17px; font-weight: bold; font-family: Georgia, 'Times New Roman', Times, serif;">
                    i
                  </span>
                </div>

                <ng-template #contentTemplate>
                  <div>
                    <p>Enter at least three characters to search</p>
                  </div>
                </ng-template>
              </ng-template>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>

      <div nz-row>
        <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24" style="text-align: right;">
          <button nz-button style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff; margin-right: 3px;"
            nzType="default" (click)="advanceFilterModalCancel()">
            Cancel
          </button>

          <button nz-button style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff; margin-right: 3px;"
            nzType="default" (click)="clearAdvanceFilter()">
            Clear
          </button>

          <button nz-button style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff; margin-right: 3px;"
            nzType="default" (click)="advanceFilterModalOk()">
            Apply
          </button>
        </div>
      </div>
    </div>
  </div>

  <div
    *ngIf="(multipleSearchText.length > 0) || (advanceMultipleSearchText.length > 0) || (advanceMultipleFederationNames.length > 0) || (advanceMultipleUnitNames.length > 0) || (advanceMultipleGroupNames.length > 0)"
    style="height: 7vh; overflow-y: auto; border-radius: 8px; background-color: white; padding: 10px; margin: 10px; position: sticky; top: 0px; z-index: 10;">
    <div nz-row>
      <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24">
        <div style="padding: 3px 0px 3px 0px;">
          <span *ngIf="multipleSearchText.length > 0">
            <span *ngFor="let text of multipleSearchText; let i = index;">
              <nz-tag [nzColor]="'magenta'" nzMode="closeable" (nzOnClose)="onClose(i)"
                style="font-size: 12px; padding: 3px; margin: 1px;">
                {{text}}
              </nz-tag>
            </span>
          </span>

          <span *ngIf="advanceMultipleSearchText.length > 0">
            <span *ngFor="let text of advanceMultipleSearchText; let j = index;">
              <nz-tag [nzColor]="'magenta'" nzMode="closeable" (nzOnClose)="onAdvanceFilterTagClose(j)"
                style="font-size: 12px; padding: 3px; margin: 1px;">
                {{text}}
              </nz-tag>
            </span>
          </span>

          <span *ngIf="advanceMultipleFederationNames.length > 0">
            <span *ngFor="let text of advanceMultipleFederationNames; let l = index;">
              <nz-tag [nzColor]="'magenta'" nzMode="closeable" (nzOnClose)="onAdvanceFilterFederationNamesTagClose(l)"
                style="font-size: 12px; padding: 3px; margin: 1px;">
                {{text}}
              </nz-tag>
            </span>
          </span>

          <span *ngIf="advanceMultipleUnitNames.length > 0">
            <span *ngFor="let text of advanceMultipleUnitNames; let m = index;">
              <nz-tag [nzColor]="'magenta'" nzMode="closeable" (nzOnClose)="onAdvanceFilterUnitNamesTagClose(m)"
                style="font-size: 12px; padding: 3px; margin: 1px;">
                {{text}}
              </nz-tag>
            </span>
          </span>

          <span *ngIf="advanceMultipleGroupNames.length > 0">
            <span *ngFor="let text of advanceMultipleGroupNames; let n = index;">
              <nz-tag [nzColor]="'magenta'" nzMode="closeable" (nzOnClose)="onAdvanceFilterGroupNamesTagClose(n)"
                style="font-size: 12px; padding: 3px; margin: 1px;">
                {{text}}
              </nz-tag>
            </span>
          </span>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="!advanceFilterModalVisible" id="activityItem" [ngStyle]="{ height: getHeigth() }"
    style="overflow-y: auto; padding: 10px;" (scroll)="onScroll($event)">
    <div id="top"></div>

    <div *ngIf="dataList.length > 0">
      <div *ngFor="let data of dataList; let i = index;"
        style="border-radius: 8px; background-color: white; padding: 10px; margin-bottom: 10px;">

        <div nz-row>
          <div nz-col nzXs="24" nzSm="24" nzMd="0" nzLg="0" nzXl="0" style="font-size: 10px;">
            <i nz-icon nzType="calendar" nzTheme="outline" style="color: #FF7A7A;"></i>&nbsp;

            <span style="color: black;">
              {{data.DATE | date: 'dd MMM yy'}}
            </span>
          </div>

          <div nz-col nzXs="24" nzSm="24" nzMd="20" nzLg="20" nzXl="20" style="font-size: 14px;">
            <span style="color: #FF7A7A;">Group Name :</span>&nbsp;
            <span style="color: black;">{{data.GROUP_NAME}}</span>
          </div>

          <div nz-col nzXs="0" nzSm="0" nzMd="4" nzLg="4" nzXl="4" style="text-align: right; font-size: 10px;">
            <i nz-icon nzType="calendar" nzTheme="outline" style="color: #FF7A7A;"></i>&nbsp;

            <span style="color: black;">
              {{data.DATE | date: 'dd MMM yy'}}
            </span>
          </div>
        </div>

        <div nz-row>
          <div nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="12" style="font-size: 14px;">
            <span style="color: #FF7A7A;">â‚¹ :</span>&nbsp;

            <span *ngIf="(!data.CHILD_GROUP_ID) || (data.CHILD_GROUP_ID == 0)">
              {{data.AMOUNT}}/-
            </span>

            <span *ngIf="(data.CHILD_GROUP_ID) && (data.CHILD_GROUP_ID > 0)">
              {{data.AMOUNT}} + {{data.CHILD_GROUP_AMOUNT}} = {{data.AMOUNT + data.CHILD_GROUP_AMOUNT}}/-
            </span>
          </div>

          <div nz-col nzXs="0" nzSm="0" nzMd="12" nzLg="12" nzXl="12" style="font-size: 14px; text-align: right;">
            <span style="color: #FF7A7A;">Mode :</span>&nbsp;

            <span>
              {{getPaymentMode(data.PAYMENT_TRANSACTION_MODE)}}
            </span>
          </div>

          <div nz-col nzXs="24" nzSm="24" nzMd="0" nzLg="0" nzXl="0" style="font-size: 14px;">
            <span style="color: #FF7A7A;">Mode :</span>&nbsp;

            <span>
              {{getPaymentMode(data.PAYMENT_TRANSACTION_MODE)}}
            </span>
          </div>
        </div>

        <div nz-row>
          <div nz-col nzSpan="24" style="font-size: 14px;">
            <span style="color: #FF7A7A;">Reference No. :</span>&nbsp;

            <span>
              {{data.PAYMENT_REFERENCE_NO}}
            </span>
          </div>
        </div>

        <div nz-row>
          <div nz-col nzSpan="24">
            <div style="font-size: 14px; word-break: break-all; text-align: justify;">
              <span style="color: #FF7A7A;">Narration :</span>&nbsp;

              <span>
                {{data.NARRATION}}
              </span>
            </div>
          </div>
        </div>

        <div nz-row style="padding-top: 10px;">
          <div nz-col nzSpan="8">
            <div style="text-align: left;">
              <span *ngIf="data.PAYMENT_TRANSACTION_MODE == 'OFFL'">
                <button nz-button (click)="viewReceipt(data.FILE_URL)" nzType="default"
                  style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff;">
                  Receipt
                </button>
              </span>
            </div>
          </div>

          <div nz-col nzSpan="8">
            <div style="text-align: center; padding: 3px;">
              <nz-tag *ngIf="data.RECEIVED_STATUS == 'P'" [nzColor]="'blue'" style="font-size: 13px; padding: 3px;">
                {{getStatus(data.RECEIVED_STATUS)}}
              </nz-tag>

              <nz-tag *ngIf="data.RECEIVED_STATUS == 'A'" [nzColor]="'green'" style="font-size: 13px; padding: 3px;">
                <span nz-icon nzType="check" nzTheme="outline"></span>&nbsp;
                {{getStatus(data.RECEIVED_STATUS)}}
              </nz-tag>

              <nz-tag *ngIf="data.RECEIVED_STATUS == 'R'" [nzColor]="'red'" style="font-size: 13px; padding: 3px;">
                <span nz-icon nzType="close" nzTheme="outline"></span>&nbsp;
                {{getStatus(data.RECEIVED_STATUS)}}
              </nz-tag>
            </div>
          </div>

          <div nz-col nzSpan="8">
            <div style="text-align: right;">
              <button nz-button (click)="ViewDetails(data.ID)" nzType="default"
                style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff;">
                Details
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="dataList.length == 0">
      <nz-empty
        [nzNotFoundImage]="'https://gw.alipayobjects.com/mdn/miniapp_social/afts/img/A*pevERLJC9v0AAAAAAAAAAABjAQAAAQ/original'"
        [nzNotFoundContent]="contentTpl">
      </nz-empty>

      <ng-template #contentTpl>
        <span>No data available.</span>
      </ng-template>
    </div>
  </div>
</nz-spin>

<nz-drawer [nzBodyStyle]="{ height: 'calc(100% - 55px)', overflow: 'auto', 'padding-bottom': '53px' }"
  [nzClosable]="false" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="800" [nzVisible]="drawerVisible"
  [nzTitle]="drawerTitle" (nzOnClose)="drawerClose()" (nzKeyboard)="true">

  <app-addpayment [sum]="0" [groupIDForPayment]="groupIDForSearching" [drawerClose]="closeCallback"
    [drawerVisible]="drawerVisible" [data]="drawerData" [currentGroupDetails]="currentGroupDetails">
  </app-addpayment>
</nz-drawer>

<nz-drawer [nzBodyStyle]="{ height: 'calc(100% - 60px)', overflow: 'auto', 'padding-bottom': '53px' }"
  [nzClosable]="false" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="800" [nzVisible]="drawerVisible4"
  [nzTitle]="drawerTitle4" (nzOnClose)="drawerClose4()" (nzKeyboard)="true">

  <app-memberspaymentdetails [drawerClose4]="closeCallback4" [drawerVisible4]="drawerVisible4" [paymentDataId]="dataId">
  </app-memberspaymentdetails>
</nz-drawer>