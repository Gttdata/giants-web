<nz-spin [nzSpinning]='loadingRecords'>
    <div
        style="border-radius: 8px; background-color: white; padding: 10px; margin: 10px; position: sticky; top: 0px; z-index: 10;">
        <div nz-row>
            <div nz-col nzXs="0" nzSm="0" nzMd="8" nzLg="8" nzXl="8">
                <div style="text-align: left; padding: 5px;">
                    <span class="formname">
                        <i nz-icon nzType="left-circle" nzTheme="outline" (click)="back()"></i>
                        {{formTitle}}
                    </span>
                </div>
            </div>

            <div nz-col nzXs="0" nzSm="0" nzMd="8" nzLg="8" nzXl="8" style="text-align: center;">
                <button nz-button nzType="default"
                    style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff;" (click)="add()"
                    *ngIf="federationID > 0">
                    <i nz-icon nzType="plus"></i>
                    Create
                </button>
            </div>

            <div nz-col nzXs="0" nzSm="0" nzMd="8" nzLg="8" nzXl="8" style="text-align: right;">
                <nz-input-group [nzPrefix]="prefixIcon" [nzSuffix]="suffixIcon">
                    <input nz-input type="text" name="search" autocomplete="off" placeholder="Search Here.."
                        (keydown.enter)="addSearchTextForSearching(searchText)" [(ngModel)]="searchText" />
                </nz-input-group>

                <ng-template #prefixIcon>
                    <span nz-icon nzType="search"></span>
                </ng-template>

                <ng-template #suffixIcon>
                    <i nz-icon nzType="filter" nzTheme="outline" (click)="openAdvanceFilter()"
                        nzTooltipTitle="Advance Filter" nzTooltipPlacement="top" nz-tooltip>
                    </i>
                </ng-template>
            </div>

            <div nz-col nzXs="24" nzSm="24" nzMd="0" nzLg="0" nzXl="0">
                <div style="text-align: center; padding: 5px;">
                    <span class="formname">
                        <i nz-icon nzType="left-circle" nzTheme="outline" (click)="back()"></i>
                        {{formTitle}}
                    </span>
                </div>
            </div>

            <div nz-col nzXs="8" nzSm="8" nzMd="0" nzLg="0" nzXl="0">
                <div style="text-align: center;">
                    <button nz-button nzType="default"
                        style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff;" (click)="add()"
                        *ngIf="federationID > 0">
                        <i nz-icon nzType="plus"></i>
                        Create
                    </button>
                </div>
            </div>

            <div nz-col nzXs="16" nzSm="16" nzMd="0" nzLg="0" nzXl="0" style="text-align: right;">
                <nz-input-group [nzPrefix]="prefixIcon" [nzSuffix]="suffixIcon">
                    <input nz-input type="text" name="search" autocomplete="off" placeholder="Search Here.."
                        (keydown.enter)="addSearchTextForSearching(searchText)" [(ngModel)]="searchText" />
                </nz-input-group>

                <ng-template #prefixIcon>
                    <span nz-icon nzType="search"></span>
                </ng-template>

                <ng-template #suffixIcon>
                    <i nz-icon nzType="filter" nzTheme="outline" (click)="openAdvanceFilter()"
                        nzTooltipTitle="Advance Filter" nzTooltipPlacement="top" nz-tooltip>
                    </i>
                </ng-template>
            </div>
        </div>
    </div>

    <div *ngIf="advanceFilterModalVisible"
        style="border-radius: 8px; background-color: white; padding: 10px; margin: 10px; position: sticky; top: 0px; z-index: 10;">
        <div style="max-height: 250px; overflow: auto;">
            <div nz-row>
                <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24">
                    <nz-form-item>
                        <nz-form-label nzNoColon>Federation(s)</nz-form-label>

                        <nz-form-control>
                            <nz-select name="federation" [nzMaxTagCount]="3" nzShowSearch nzMode="multiple" nzAllowClear
                                style="width: 100%" nzPlaceHolder="Select Federation(s)" [(ngModel)]="FEDERATION_ID">

                                <nz-option *ngFor="let federation of federations;" [nzValue]="federation.NAME"
                                    [nzLabel]="federation.NAME">
                                </nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>

            <div nz-row>
                <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24" style="text-align: right;">
                    <button nz-button
                        style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff; margin-right: 3px;"
                        nzType="default" (click)="advanceFilterModalCancel()">
                        Cancel
                    </button>

                    <button nz-button
                        style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff; margin-right: 3px;"
                        nzType="default" (click)="clearAdvanceFilter()">
                        Clear
                    </button>

                    <button nz-button
                        style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff; margin-right: 3px;"
                        nzType="default" (click)="advanceFilterModalOk()">
                        Apply
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="(multipleSearchText.length > 0) || (advanceMultipleSearchText.length > 0) || (advanceMultipleFederationNames.length > 0)"
        style="height: 7vh; overflow-y: auto; border-radius: 8px; background-color: white; padding: 10px; margin: 10px; position: sticky; top: 0px; z-index: 10;">
        <div nz-row>
            <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24">
                <div style="padding: 3px 0px 3px 0px;">
                    <span *ngIf="multipleSearchText.length > 0">
                        <span *ngFor="let text of multipleSearchText; let i = index;">
                            <nz-tag [nzColor]="'magenta'" nzMode="closeable" (nzOnClose)="onClose(i)"
                                style="font-size: 10px; padding: 1px; margin: 1px;">
                                {{text}}
                            </nz-tag>
                        </span>
                    </span>

                    <span *ngIf="advanceMultipleSearchText.length > 0">
                        <span *ngFor="let text of advanceMultipleSearchText; let j = index;">
                            <nz-tag [nzColor]="'magenta'" nzMode="closeable" (nzOnClose)="onAdvanceFilterTagClose(j)"
                                style="font-size: 10px; padding: 1px; margin: 1px;">
                                {{text}}
                            </nz-tag>
                        </span>
                    </span>

                    <span *ngIf="advanceMultipleFederationNames.length > 0">
                        <span *ngFor="let text of advanceMultipleFederationNames; let k = index;">
                            <nz-tag [nzColor]="'magenta'" nzMode="closeable"
                                (nzOnClose)="onAdvanceFilterFederationNamesTagClose(k)"
                                style="font-size: 10px; padding: 1px; margin: 1px;">
                                {{text}}
                            </nz-tag>
                        </span>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="!advanceFilterModalVisible" id="activityItem" [ngStyle]="{ height: getHeigth() }"
        style="overflow-y: auto; padding: 10px;" (scroll)="onScroll($event)">
        <div id="top"></div>

        <div *ngIf="dataList.length > 0">
            <div *ngFor="let unit of dataList; let i = index;"
                style="border-radius: 8px; background-image: linear-gradient(to bottom right, #ffffff, #ffffff); padding: 10px; margin-bottom: 10px;">
                <div nz-row>
                    <div nz-col nzXs="24" nzSm="24" nzMd="0" nzLg="0" nzXl="0">
                        <div style="text-align: right; padding: 5px;">
                            <span style="font-size: 10px; padding: 5px; background-color: white;"
                                *ngIf="(unit.FEDERATION_SHORT_NAME != null) || (unit.SHORT_NAME != null)">
                                <span style=" border: 1px solid rgb(2, 4, 5); padding: 3px; background-color: #f0f2f5;">
                                    {{unit.FEDERATION_SHORT_NAME}}
                                </span>

                                <span
                                    style=" border: 1px solid rgb(6, 11, 14); padding: 3px; background-color: #f0f2f5;"
                                    *ngIf="unit.SHORT_NAME != null">
                                    {{unit.SHORT_NAME}}
                                </span>
                            </span>

                            <span style="border-radius: 50%; padding: 5px; background-color: white;"
                                *ngIf="((federationID > 0) && (federationID == unit.FEDERATION_ID)) || (unitID == unit['UNIT_ID'])">
                                <i nz-icon nzType="edit" nzTheme="twotone" (click)="edit(unit)"></i>
                            </span>
                        </div>
                    </div>

                    <div nz-col nzXs="24" nzSm="24" nzMd="16" nzLg="16" nzXl="16">
                        <div style="font-weight: bold; text-align: left; color: black; padding: 5px;">
                            {{unit["UNIT_NAME"]}}
                        </div>
                    </div>

                    <div nz-col nzXs="0" nzSm="0" nzMd="8" nzLg="8" nzXl="8">
                        <div style="text-align: right; padding: 5px;">
                            <span style="font-size: 10px; padding: 5px; background-color: white;"
                                *ngIf="(unit.FEDERATION_SHORT_NAME != null) || (unit.SHORT_NAME != null)">
                                <span style=" border: 1px solid rgb(2, 4, 5); padding: 3px; background-color: #f0f2f5;">
                                    {{unit.FEDERATION_SHORT_NAME}}
                                </span>

                                <span
                                    style=" border: 1px solid rgb(6, 11, 14); padding: 3px; background-color: #f0f2f5;"
                                    *ngIf="unit.SHORT_NAME != null">
                                    {{unit.SHORT_NAME}}
                                </span>
                            </span>

                            <span style="border-radius: 50%; padding: 5px; background-color: white;"
                                *ngIf="((federationID > 0) && (federationID == unit.FEDERATION_ID)) || (unitID == unit['UNIT_ID'])">
                                <i nz-icon nzType="edit" nzTheme="twotone" (click)="edit(unit)"></i>
                            </span>
                        </div>
                    </div>

                    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24">
                        <div style="font-size: 10px; text-align: left; color: gray; padding: 5px;">
                            <i nz-icon nzType="global" nzTheme="outline" style="color: #ff7a7a"></i>
                            {{unit.FEDERATION_NAME}}
                        </div>
                    </div>

                    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24"
                        style="border-radius: 8px; background-color: #f0f2f5; padding: 7px; margin-left: 0px; margin-right: 10px; font-size: 12px; text-align: center; color: #000102;">
                        <div nz-col nzXs="8" nzSm="8" nzMd="4" nzLg="4" nzXl="4" style="margin-bottom: -12px;">
                            <p
                                style="font-family: 'Courier New', Courier, monospace; font-size: 15px; font-weight: bold;">
                                {{unit.POST_COUNT || 0}}
                            </p>

                            <p style="margin-top: -10px"> <i nz-icon nzType="qrcode" nzTheme="outline"></i>
                                Posts
                            </p>
                        </div>

                        <div nz-col nzXs="8" nzSm="8" nzMd="5" nzLg="5" nzXl="5" style="margin-bottom: -12px;">
                            <p
                                style="font-family: 'Courier New', Courier, monospace; font-size: 15px; font-weight: bold;">
                                {{unit.MEETING_COUNT || 0 }}
                            </p>

                            <p style="margin-top: -10px"><i nz-icon nzType="calendar" nzTheme="outline"></i>
                                Meetings
                            </p>
                        </div>

                        <div nz-col nzXs="8" nzSm="8" nzMd="5" nzLg="5" nzXl="5" style="margin-bottom: -12px;">
                            <p
                                style="font-family: 'Courier New', Courier, monospace; font-size: 15px; font-weight: bold;">
                                {{unit.EVENT_COUNT || 0}}
                            </p>

                            <p style="margin-top: -10px"><i nz-icon nzType="carry-out" nzTheme="outline"></i>
                                Events
                            </p>
                        </div>

                        <div nz-col nzXs="8" nzSm="8" nzMd="5" nzLg="5" nzXl="5" style="margin-bottom: -12px;">
                            <p
                                style="font-family: 'Courier New', Courier, monospace; font-size: 15px; font-weight: bold;">
                                {{unit.CIRCULAR_COUNT || 0}}
                            </p>

                            <p style="margin-top: -10px"><i nz-icon nzType="audit" nzTheme="outline"></i>
                                Circulars
                            </p>
                        </div>

                        <div nz-col nzXs="8" nzSm="8" nzMd="5" nzLg="5" nzXl="5" style="margin-bottom: -12px;">
                            <p
                                style="font-family: 'Courier New', Courier, monospace; font-size: 15px; font-weight: bold;">
                                {{unit.PROJECT_COUNT || 0}}
                            </p>

                            <p style="margin-top: -10px"><i nz-icon nzType="apartment" nzTheme="outline"></i>
                                Projects
                            </p>
                        </div>
                    </div>

                    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24">
                        <div style="text-align: center; padding-top: 5px;">
                            <button nz-button nzType="default"
                                style="height: 25px; border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff; margin: 3px;"
                                (click)="goToMemberMaster(unit)" nzJustify="end">
                                <span style="font-size: 10px;">
                                    <i nz-icon nzType="team" nzTheme="outline" style="font-size: 10px;"></i>
                                    Members : {{unit.MEMBER_COUNT || 0}}
                                </span>
                            </button>

                            <button nz-button nzType="default"
                                style="height: 25px; border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff; margin: 3px;"
                                (click)="addMembers(unit)" nzJustify="end">
                                <span style="font-size: 10px;">
                                    <i nz-icon nzType="user" nzTheme="outline" style="font-size: 10px;"></i>
                                    BOD
                                </span>
                            </button>

                            <button nz-button nzType="default"
                                style="height: 25px; border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff; margin: 3px;"
                                (click)="goToGroupMaster(unit)" nzJustify="end">
                                <span style="font-size: 10px;">
                                    <i nz-icon nzType="team" nzTheme="outline" style="font-size: 10px;"></i>
                                    Groups : {{unit.GROUP_COUNT || 0}}
                                </span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div *ngIf="dataList.length == 0" style="margin-top: 20px">
            <nz-empty
                [nzNotFoundImage]="'https://gw.alipayobjects.com/mdn/miniapp_social/afts/img/A*pevERLJC9v0AAAAAAAAAAABjAQAAAQ/original'"
                [nzNotFoundContent]="contentTpl">
            </nz-empty>

            <ng-template #contentTpl>
                <span>No data available.</span>
            </ng-template>
        </div>
    </div>
</nz-spin>

<!-- Unit drawer -->
<nz-drawer [nzBodyStyle]="{ height: 'calc(100% - 55px)', overflow: 'auto', 'padding-bottom': '53px' }"
    [nzClosable]="false" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="getUnitDrawerWidth()"
    [nzVisible]="drawerVisible" [nzTitle]="drawerTitle" (nzOnClose)="drawerClose()" (nzKeyboard)="true">

    <app-unit-drawer [drawerClose]="closeCallback" [drawerVisible]="drawerVisible" [data]="drawerData">
    </app-unit-drawer>
</nz-drawer>

<!-- Assign Unit BOD -->
<nz-drawer [nzBodyStyle]="{ height: 'calc(100% - 55px)', overflow: 'auto', 'padding-bottom': '53px' }"
    [nzClosable]="false" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="getWidth()"
    [nzVisible]="memberDrawerVisible" [nzTitle]="memberDrawerTitle" (nzOnClose)="memberDrawerClose()"
    (nzKeyboard)="true">

    <app-assign-unit-member [drawerClose]="memberDrawerCloseCallback" [drawerVisible]="memberDrawerVisible"
        [data]="memberDrawerData">
    </app-assign-unit-member>
</nz-drawer>