<nz-spin [nzSpinning]='loadingRecords'>
    <div
        style="border-radius: 8px; background-color: white; padding: 10px; margin: 10px;  position: sticky; top: 0px; z-index: 10;">
        <div nz-row>
            <div nz-col nzXs="0" nzSm="0" nzMd="8" nzLg="8" nzXl="8">
                <div style="text-align: left; padding: 5px;">
                    <span class="formname">
                        {{formTitle}}
                    </span>
                </div>
            </div>

            <div nz-col nzXs="0" nzSm="0" nzMd="8" nzLg="8" nzXl="8">
                <div style="text-align: center;" *ngIf="(federationID > 0) || (unitID > 0) || (groupID > 0)">
                    <button nz-button nzType="default"
                        style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff;" (click)="add()">
                        <i nz-icon nzType="plus"></i>
                        Create
                    </button>
                </div>
            </div>

            <div nz-col nzXs="0" nzSm="0" nzMd="8" nzLg="8" nzXl="8" style="text-align: right;">
                <nz-input-group [nzSuffix]="suffixIcon" [nzPrefix]="prefixIcon">
                    <input nz-input type="text" name="search" autocomplete="off" placeholder="Search Here..."
                        (keydown.enter)="addSearchTextForSearching(searchText)" [(ngModel)]="searchText" />
                </nz-input-group>

                <ng-template #prefixIcon>
                    <span nz-icon nzType="search"></span>
                </ng-template>

                <ng-template #suffixIcon>
                    <i nz-icon nzType="filter" nzTheme="outline" (click)="openAdvanceFilter()"
                        nzTooltipTitle="Advance Filter" nzTooltipPlacement="top" nz-tooltip>
                    </i>
                </ng-template>
            </div>

            <div nz-col nzXs="8" nzSm="8" nzMd="0" nzLg="0" nzXl="0">
                <div style="text-align: left; padding: 5px;">
                    <span class="formname">
                        {{formTitle}}
                    </span>
                </div>
            </div>

            <div nz-col nzXs="16" nzSm="16" nzMd="0" nzLg="0" nzXl="0" style="text-align: right;">
                <nz-input-group [nzSuffix]="suffixIcon" [nzPrefix]="prefixIcon">
                    <input nz-input type="text" name="search" autocomplete="off" placeholder="Search Here..."
                        (keydown.enter)="addSearchTextForSearching(searchText)" [(ngModel)]="searchText" />
                </nz-input-group>

                <ng-template #prefixIcon>
                    <span nz-icon nzType="search"></span>
                </ng-template>

                <ng-template #suffixIcon>
                    <i nz-icon nzType="filter" nzTheme="outline" (click)="openAdvanceFilter()"
                        nzTooltipTitle="Advance Filter" nzTooltipPlacement="top" nz-tooltip>
                    </i>
                </ng-template>
            </div>

            <div nz-col nzXs="24" nzSm="24" nzMd="0" nzLg="0" nzXl="0">
                <div style="text-align: center; padding-top: 10px;"
                    *ngIf="(federationID > 0) || (unitID > 0) || (groupID > 0)">
                    <button nz-button nzType="default"
                        style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff;" (click)="add()">
                        <i nz-icon nzType="plus"></i>
                        Create
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="advanceFilterModalVisible"
        style="border-radius: 8px; background-color: white; padding: 10px; margin: 10px;  position: sticky; top: 0px; z-index: 10;">
        <div style="max-height: 250px; overflow: auto;">
            <div nz-row>
                <div nz-col nzXs="12" nzSm="12" nzMd="12" nzLg="12" nzXl="12">
                    <nz-form-item>
                        <nz-form-label nzNoColon>From Date</nz-form-label>

                        <nz-form-control>
                            <nz-date-picker name="fromDate" nzFormat="dd/MM/yyyy"
                                (ngModelChange)="onFromDateChange($event)" [(ngModel)]="ADVANCE_FILTER_FROM_DATE">
                            </nz-date-picker>
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <div nz-col nzXs="12" nzSm="12" nzMd="12" nzLg="12" nzXl="12">
                    <nz-form-item>
                        <nz-form-label nzNoColon>To Date</nz-form-label>

                        <nz-form-control>
                            <nz-date-picker name="toDate" [nzDisabledDate]="disabledToDate" nzFormat="dd/MM/yyyy"
                                [(ngModel)]="ADVANCE_FILTER_TO_DATE">
                            </nz-date-picker>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>

            <div nz-row>
                <div nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="12">
                    <nz-form-item>
                        <nz-form-label nzNoColon>Federation(s)</nz-form-label>

                        <nz-form-control>
                            <nz-select name="federation" [nzMaxTagCount]="3" nzShowSearch nzMode="multiple" nzAllowClear
                                style="width: 100%" nzPlaceHolder="Select Federation(s)" [(ngModel)]="FEDERATION_ID">

                                <nz-option *ngFor="let federation of federations;" [nzValue]="federation.NAME"
                                    [nzLabel]="federation.NAME">
                                </nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <div nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="12">
                    <nz-form-item>
                        <nz-form-label nzNoColon>Unit(s)</nz-form-label>

                        <nz-form-control>
                            <nz-select name="unit" [nzMaxTagCount]="3" [nzSuffixIcon]="suffixIcon" nzShowSearch
                                nzServerSearch nzMode="multiple" nzAllowClear style="width: 100%"
                                nzPlaceHolder="Type here to search" [(ngModel)]="UNIT_ID"
                                (nzOnSearch)="getUnits($event)">

                                <nz-option nzCustomContent *ngFor="let unit of units;" [nzValue]="unit.NAME"
                                    [nzLabel]="unit.NAME">
                                    <div nz-row>
                                        <div nz-col nzSpan="24">
                                            {{unit.NAME}}
                                        </div>

                                        <div nz-col nzSpan="24">
                                            <div style="font-size: 10px; color: gray;">
                                                <i nz-icon nzType="global" nzTheme="outline" style="color: #ff8d73;">
                                                </i>

                                                {{unit.FEDERATION_NAME}}
                                            </div>
                                        </div>
                                    </div>
                                </nz-option>
                            </nz-select>

                            <ng-template #suffixIcon>
                                <div style="cursor: pointer;">
                                    <span nz-popover nzPopoverTitle="Info" [nzPopoverContent]="contentTemplate"
                                        nzPopoverPlacement="top"
                                        style="font-size: 17px; font-weight: bold; font-family: Georgia, 'Times New Roman', Times, serif;">
                                        i
                                    </span>
                                </div>

                                <ng-template #contentTemplate>
                                    <div>
                                        <span>Enter at least three characters to search</span>
                                    </div>
                                </ng-template>
                            </ng-template>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>

            <div nz-row>
                <div nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="12">
                    <nz-form-item>
                        <nz-form-label nzNoColon>Group(s)</nz-form-label>

                        <nz-form-control>
                            <nz-select name="group" [nzMaxTagCount]="3" [nzSuffixIcon]="suffixIcon" nzShowSearch
                                nzServerSearch nzMode="multiple" nzAllowClear style="width: 100%"
                                nzPlaceHolder="Type here to search" [(ngModel)]="GROUP_ID"
                                (nzOnSearch)="getGroups($event)">

                                <nz-option nzCustomContent *ngFor="let group of groups;" [nzValue]="group.NAME"
                                    [nzLabel]="group.NAME">
                                    <div nz-row>
                                        <div nz-col nzSpan="24">
                                            {{group.NAME}}
                                        </div>

                                        <div nz-col nzSpan="24">
                                            <div style="font-size: 10px; color: gray;">
                                                <i nz-icon nzType="global" nzTheme="outline" style="color: #ff8d73;">
                                                </i>

                                                {{group.FEDERATION_NAME}}
                                            </div>
                                        </div>

                                        <div nz-col nzSpan="24">
                                            <div style="font-size: 10px; color: gray;">
                                                <i nz-icon nzType="deployment-unit" nzTheme="outline"
                                                    style="color: #ff8d73;">
                                                </i>

                                                {{group.UNIT_NAME}}
                                            </div>
                                        </div>
                                    </div>
                                </nz-option>
                            </nz-select>

                            <ng-template #suffixIcon>
                                <div style="cursor: pointer;">
                                    <span nz-popover nzPopoverTitle="Info" [nzPopoverContent]="contentTemplate"
                                        nzPopoverPlacement="top"
                                        style="font-size: 17px; font-weight: bold; font-family: Georgia, 'Times New Roman', Times, serif;">
                                        i
                                    </span>
                                </div>

                                <ng-template #contentTemplate>
                                    <div>
                                        <span>Enter at least three characters to search</span>
                                    </div>
                                </ng-template>
                            </ng-template>
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <div nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="12">
                    <nz-form-item>
                        <nz-form-label nzNoColon>Circular Type(s)</nz-form-label>

                        <nz-form-control>
                            <nz-select name="circularType" [nzMaxTagCount]="3" [nzSuffixIcon]="suffixIcon" nzShowSearch
                                nzServerSearch nzMode="multiple" nzAllowClear style="width: 100%"
                                nzPlaceHolder="Type here to search" [(ngModel)]="CIRCULAR_TYPE_ID"
                                (nzOnSearch)="getCircularsTypes($event)">

                                <nz-option *ngFor="let circular of circulars;" [nzValue]="circular.NAME"
                                    [nzLabel]="circular.NAME">
                                </nz-option>
                            </nz-select>

                            <ng-template #suffixIcon>
                                <div style="cursor: pointer;">
                                    <span nz-popover nzPopoverTitle="Info" [nzPopoverContent]="contentTemplate"
                                        nzPopoverPlacement="top"
                                        style="font-size: 17px; font-weight: bold; font-family: Georgia, 'Times New Roman', Times, serif;">
                                        i
                                    </span>
                                </div>

                                <ng-template #contentTemplate>
                                    <div>
                                        <span>Enter at least three characters to search</span>
                                    </div>
                                </ng-template>
                            </ng-template>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>

            <div nz-row>
                <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24" style="text-align: right;">
                    <button nz-button
                        style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff; margin-right: 3px;"
                        nzType="default" (click)="advanceFilterModalCancel()">
                        Cancel
                    </button>

                    <button nz-button
                        style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff; margin-right: 3px;"
                        nzType="default" (click)="clearAdvanceFilter()">
                        Clear
                    </button>

                    <button nz-button style="border-radius: 5px; color: #47a7ff; border: solid 1px #47a7ff;"
                        nzType="default" (click)="advanceFilterModalOk()">
                        Apply
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="(multipleSearchText.length > 0) || (advanceMultipleSearchText.length > 0) || (advanceMultipleFederationNames.length > 0) || (advanceMultipleUnitNames.length > 0) || (advanceMultipleGroupNames.length > 0) || (advanceMultipleCircularTypeNames.length > 0)"
        style="height: 7vh; overflow-y: auto; border-radius: 8px; background-color: white; padding: 10px; margin: 10px; position: sticky; top: 0px; z-index: 10;">
        <div nz-row>
            <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24">
                <div style="padding: 3px 0px 3px 0px;">
                    <span *ngIf="multipleSearchText.length > 0">
                        <span *ngFor="let text of multipleSearchText; let i = index;">
                            <nz-tag [nzColor]="'magenta'" nzMode="closeable" (nzOnClose)="onClose(i)"
                                style="font-size: 10px; padding: 1px; margin: 1px;">
                                {{text}}
                            </nz-tag>
                        </span>
                    </span>

                    <span *ngIf="advanceMultipleSearchText.length > 0">
                        <span *ngFor="let text of advanceMultipleSearchText; let j = index;">
                            <nz-tag [nzColor]="'magenta'" nzMode="closeable" (nzOnClose)="onAdvanceFilterTagClose(j)"
                                style="font-size: 10px; padding: 1px; margin: 1px;">
                                {{text}}
                            </nz-tag>
                        </span>
                    </span>

                    <span *ngIf="advanceMultipleFederationNames.length > 0">
                        <span *ngFor="let text of advanceMultipleFederationNames; let k = index;">
                            <nz-tag [nzColor]="'magenta'" nzMode="closeable"
                                (nzOnClose)="onAdvanceFilterFederationNamesTagClose(k)"
                                style="font-size: 10px; padding: 1px; margin: 1px;">
                                {{text}}
                            </nz-tag>
                        </span>
                    </span>

                    <span *ngIf="advanceMultipleUnitNames.length > 0">
                        <span *ngFor="let text of advanceMultipleUnitNames; let l = index;">
                            <nz-tag [nzColor]="'magenta'" nzMode="closeable"
                                (nzOnClose)="onAdvanceFilterUnitNamesTagClose(l)"
                                style="font-size: 10px; padding: 1px; margin: 1px;">
                                {{text}}
                            </nz-tag>
                        </span>
                    </span>

                    <span *ngIf="advanceMultipleGroupNames.length > 0">
                        <span *ngFor="let text of advanceMultipleGroupNames; let m = index;">
                            <nz-tag [nzColor]="'magenta'" nzMode="closeable"
                                (nzOnClose)="onAdvanceFilterGroupNamesTagClose(m)"
                                style="font-size: 10px; padding: 1px; margin: 1px;">
                                {{text}}
                            </nz-tag>
                        </span>
                    </span>

                    <span *ngIf="advanceMultipleCircularTypeNames.length > 0">
                        <span *ngFor="let text of advanceMultipleCircularTypeNames; let n = index;">
                            <nz-tag [nzColor]="'magenta'" nzMode="closeable"
                                (nzOnClose)="onAdvanceFilterCircularTypeTagClose(n)"
                                style="font-size: 10px; padding: 1px; margin: 1px;">
                                {{text}}
                            </nz-tag>
                        </span>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="!advanceFilterModalVisible" id="activityItem" [ngStyle]="{ height: getHeigth() }"
        style="overflow-y: auto; padding: 10px;" (scroll)="onScroll($event)">
        <div id="top"></div>

        <div *ngIf="dataList.length > 0">
            <div *ngFor="let data of dataList; let i = index;"
                style="border-radius: 8px; background-color: white; padding: 10px; margin-bottom: 10px;">
                <div nz-row>
                    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24">
                        <span style="float: left; padding: 5px 0px 5px 0px; font-size: 10px; color: green;"
                            *ngIf="(userID == data['CREATER_ID']) && !(data['STATUS'] == 'P')">
                            In Draft Mode
                        </span>

                        <span
                            style="float: right; cursor: pointer; padding: 3px 0px 3px 0px; text-align: center; height: 30px; width: 30px; border-radius: 50%; background-color: #f0f2f5;"
                            *ngIf="((userID == data['CREATER_ID']) || ((userID == data['SIGNING_AUTHORITY1']) && (data['STATUS'] == 'D')) || ((userID == data['SIGNING_AUTHORITY2']) && (data['STATUS'] == 'D')) || ((userID == data['SIGNING_AUTHORITY3']) && (data['STATUS'] == 'D')))">
                            <a nz-dropdown [nzDropdownMenu]="menu">
                                <i nz-icon nzType="more" nzTheme="outline"
                                    style="color: black; font-size: 21px; padding: 2px;">
                                </i>
                            </a>

                            <nz-dropdown-menu #menu="nzDropdownMenu">
                                <ul nz-menu>
                                    <span
                                        *ngIf="!(data.SIGNING_AUTHORITY2) && !(data.SIGNING_AUTHORITY3) && (data['STATUS'] == 'D')">
                                        <li nz-menu-item nz-popconfirm
                                            nzPopconfirmTitle="Are you sure publish this circular?"
                                            (nzOnConfirm)="publishCircular(data)" (nzOnCancel)="cancel()"
                                            nzPopconfirmPlacement="topLeft" style="color: blue;">
                                            Publish Circular
                                        </li>
                                    </span>

                                    <span
                                        *ngIf="(data.SIGNING_AUTHORITY2) && !(data.SIGNING_AUTHORITY3) && (data['STATUS'] == 'D')">
                                        <span *ngIf="(data.SIGNING_AUTHORITY2_STATUS == 'A')">
                                            <li nz-menu-item nz-popconfirm
                                                nzPopconfirmTitle="Are you sure publish this circular?"
                                                (nzOnConfirm)="publishCircular(data)" (nzOnCancel)="cancel()"
                                                nzPopconfirmPlacement="topLeft" style="color: blue;">
                                                Publish Circular
                                            </li>
                                        </span>
                                    </span>

                                    <span
                                        *ngIf="(data.SIGNING_AUTHORITY2) && (data.SIGNING_AUTHORITY3) && (data['STATUS'] == 'D')">
                                        <span
                                            *ngIf="(data.SIGNING_AUTHORITY2_STATUS == 'A') && (data.SIGNING_AUTHORITY3_STATUS == 'A')">
                                            <li nz-menu-item nz-popconfirm
                                                nzPopconfirmTitle="Are you sure publish this circular?"
                                                (nzOnConfirm)="publishCircular(data)" (nzOnCancel)="cancel()"
                                                nzPopconfirmPlacement="topLeft" style="color: blue;">
                                                Publish Circular
                                            </li>
                                        </span>
                                    </span>

                                    <li nz-menu-item *ngIf="(userID == data['CREATER_ID']) && (data['STATUS'] == 'D')"
                                        (click)="edit(data)" style="color: green;">
                                        Edit Circular
                                    </li>

                                    <li nz-menu-item *ngIf="(userID != data['CREATER_ID']) && (data['STATUS'] == 'D')"
                                        (click)="edit(data)" style="color: blue;">
                                        Approve/ Reject Circular
                                    </li>

                                    <li nz-menu-item *ngIf="userID == data['CREATER_ID']" nz-popconfirm
                                        nzPopconfirmTitle="Are you sure, want to delete this circular?"
                                        (nzOnConfirm)="deleteCircular(data)" (nzOnCancel)="cancel()"
                                        nzPopconfirmPlacement="topLeft" style="color: red;">
                                        Delete Circular
                                    </li>
                                </ul>
                            </nz-dropdown-menu>
                        </span>
                    </div>

                    <div nz-col nzXs="5" nzSm="5" nzMd="2" nzLg="2" nzXl="2">
                        <div style="padding: 3px 0px 0px 0px;">
                            <img style="width: 50px; height: 50px; border-radius: 50%"
                                [src]="getProfilePhoto(data.CREATOR_PROFILE_IMAGE)" alt="user">
                        </div>
                    </div>

                    <div nz-col nzXs="19" nzSm="19" nzMd="22" nzLg="22" nzXl="22">
                        <div nz-row>
                            <div nz-col nzXs="0" nzSm="0" nzMd="19" nzLg="19" nzXl="19">
                                <div style="padding: 3px 0px 0px 0px;">
                                    <span style="cursor: pointer;" (click)="onMemberNameClick(data['CREATOR_NAME'])">
                                        <b style="color: black;">
                                            {{data['CREATOR_NAME']}}
                                        </b>

                                        <span style="font-size: 10px; color: #ff7a7a; font-weight: bold;">
                                            {{data['MEMBER_ROLE']}}
                                        </span>
                                    </span>
                                </div>
                            </div>

                            <div nz-col nzXs="0" nzSm="0" nzMd="5" nzLg="5" nzXl="5">
                                <div style="font-size: 10px; text-align: right; padding: 3px 0px 0px 0px;">
                                    <span nz-icon nzType="calendar" nzTheme="outline" style="color: #FF7A7A;"></span>
                                    {{data['DATE'] | date: 'dd MMM yyyy'}}
                                </div>
                            </div>

                            <div nz-col nzXs="24" nzSm="24" nzMd="0" nzLg="0" nzXl="0">
                                <span style="cursor: pointer; padding: 3px 0px 0px 0px;"
                                    (click)="onMemberNameClick(data['CREATOR_NAME'])">

                                    <b style="color: black;">
                                        {{data['CREATOR_NAME']}}
                                    </b>
                                </span>
                            </div>

                            <div nz-col nzXs="24" nzSm="24" nzMd="0" nzLg="0" nzXl="0">
                                <div style="font-size: 10px; color: #FF7A7A;">
                                    <b>{{data['MEMBER_ROLE']}}</b>
                                </div>
                            </div>

                            <div nz-col nzXs="24" nzSm="24" nzMd="0" nzLg="0" nzXl="0">
                                <div style="font-size: 10px;">
                                    <span nz-icon nzType="calendar" nzTheme="outline" style="color: #FF7A7A;"></span>
                                    {{data['DATE'] | date: 'dd MMM yyyy'}}
                                </div>
                            </div>
                        </div>

                        <div nz-row>
                            <div nz-col nzXs="0" nzSm="0" nzMd="16" nzLg="16" nzXl="16">
                                <div style="font-size: 10px;">
                                    Home Group : {{data['GROUP_NAME']}}
                                </div>
                            </div>

                            <div nz-col nzXs="0" nzSm="0" nzMd="8" nzLg="8" nzXl="8">
                                <div style="font-size: 10px; color:#FF7A7A; text-align: right;">
                                    {{data["CIRCULAR_NO"]}}
                                </div>
                            </div>

                            <div nz-col nzXs="0" nzSm="0" nzMd="24" nzLg="24" nzXl="24">
                                <div style="font-size: 10px;">
                                    Circular Type : {{data['CIRCULAR_TYPE_NAME']}}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div nz-col nzXs="24" nzSm="24" nzMd="0" nzLg="0" nzXl="0">
                        <div style="font-size: 10px; margin-top: 5px;">
                            Circular Type : {{data['CIRCULAR_TYPE_NAME']}}
                        </div>
                    </div>

                    <div nz-col nzXs="24" nzSm="24" nzMd="0" nzLg="0" nzXl="0">
                        <div style="font-size: 10px;">
                            Home Group : {{data['GROUP_NAME']}}
                        </div>
                    </div>

                    <div nz-col nzXs="24" nzSm="24" nzMd="0" nzLg="0" nzXl="0">
                        <div style="font-size: 10px; color:#FF7A7A;">
                            {{data['CIRCULAR_NO']}}
                        </div>
                    </div>

                    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24">
                        <div
                            style="width: 100%; font-size: 12px; word-wrap: break-word; text-align: justify; padding: 3px 0px 3px 0px; color: black;">
                            {{data['SUBJECT']}}
                        </div>
                    </div>

                    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24"
                        *ngIf="!(data['SIGNING_AUTHORITY2_REMARK'] == '')">
                        <div nz-row>
                            <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24">
                                <span (click)="auth2RejectRemarkExpand[i] = !auth2RejectRemarkExpand[i]">
                                    <i nz-icon style="font-size: 12px;"
                                        [nzType]="auth2RejectRemarkExpand[i] ? 'down' : 'right'" nzTheme="outline">
                                    </i>
                                </span>

                                &nbsp;

                                <span style="font-size: 12px; font-weight: bold; color: red;">
                                    <b>Rejected By Signing Authority 2</b>
                                </span>
                            </div>

                            <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24"
                                *ngIf="auth2RejectRemarkExpand[i]">
                                <span style="font-size: 13px;">
                                    {{data['SIGNING_AUTHORITY2_REMARK']}}
                                </span>
                            </div>
                        </div>
                    </div>

                    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24"
                        *ngIf="(data['SIGNING_AUTHORITY2']) && !(data['SIGNING_AUTHORITY2'] == userID) && (data['SUBMITTED_TO_SIGNING_AUTHORITY2']) && (data['SIGNING_AUTHORITY2_STATUS'] == 'NA') && (data['STATUS'] == 'D')">
                        <span style="font-size: 12px; font-weight: bold; color: green;">
                            <b>Submited To Signing Authority 2</b>
                        </span>
                    </div>

                    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24"
                        *ngIf="(data['SIGNING_AUTHORITY2']) && (data['SIGNING_AUTHORITY2'] == userID) && (data['SUBMITTED_TO_SIGNING_AUTHORITY2']) && (data['SIGNING_AUTHORITY2_STATUS'] == 'NA') && (data['STATUS'] == 'D')">
                        <span style="font-size: 12px; font-weight: bold; color: blue;">
                            <b>Submited To You</b>
                        </span>
                    </div>

                    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24"
                        *ngIf="(data['SIGNING_AUTHORITY2']) && (data['SUBMITTED_TO_SIGNING_AUTHORITY2']) && (data['SIGNING_AUTHORITY2_STATUS'] == 'A') && (data['STATUS'] == 'D')">
                        <span style="font-size: 12px; font-weight: bold; color: green;">
                            <b>Approved By Signing Authority 2</b>
                        </span>
                    </div>

                    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24"
                        *ngIf="!(data['SIGNING_AUTHORITY3_REMARK'] == '')">
                        <div nz-row>
                            <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24">
                                <span (click)="auth3RejectRemarkExpand[i] = !auth3RejectRemarkExpand[i]">
                                    <i nz-icon style="font-size: 12px;"
                                        [nzType]="auth3RejectRemarkExpand[i] ? 'down' : 'right'" nzTheme="outline">
                                    </i>
                                </span>

                                &nbsp;

                                <span style="font-size: 12px; font-weight: bold; color: red;">
                                    <b>Rejected By Signing Authority 3</b>
                                </span>
                            </div>

                            <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24"
                                *ngIf="auth3RejectRemarkExpand[i]">
                                <span style="font-size: 13px;">
                                    {{data['SIGNING_AUTHORITY3_REMARK']}}
                                </span>
                            </div>
                        </div>
                    </div>

                    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24"
                        *ngIf="(data['SIGNING_AUTHORITY3']) && !(data['SIGNING_AUTHORITY3'] == userID) && (data['SUBMITTED_TO_SIGNING_AUTHORITY3']) && (data['SIGNING_AUTHORITY3_STATUS'] == 'NA') && (data['STATUS'] == 'D')">
                        <span style="font-size: 12px; font-weight: bold; color: green;">
                            <b>Submited To Signing Authority 3</b>
                        </span>
                    </div>

                    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24"
                        *ngIf="(data['SIGNING_AUTHORITY3']) && (data['SIGNING_AUTHORITY3'] == userID) && (data['SUBMITTED_TO_SIGNING_AUTHORITY3']) && (data['SIGNING_AUTHORITY3_STATUS'] == 'NA') && (data['STATUS'] == 'D')">
                        <span style="font-size: 12px; font-weight: bold; color: blue;">
                            <b>Submited To You</b>
                        </span>
                    </div>

                    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24"
                        *ngIf="(data['SIGNING_AUTHORITY3']) && (data['SUBMITTED_TO_SIGNING_AUTHORITY3']) && (data['SIGNING_AUTHORITY3_STATUS'] == 'A') && (data['STATUS'] == 'D')">
                        <span style="font-size: 12px; font-weight: bold; color: green;">
                            <b>Approved By Signing Authority 3</b>
                        </span>
                    </div>

                    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24">
                        <nz-divider></nz-divider>
                    </div>

                    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24">
                        <div style="text-align: right;">
                            <div style="display: inline;">
                                <span style="cursor: pointer;" (click)="viewPDF(i,data)">
                                    <i nz-icon nzType="paper-clip" nzTheme="outline" style="font-size: 17px;"></i>

                                    <span style="font-size: 12px;">
                                        View circular
                                    </span>
                                </span>
                            </div>

                            <div style="display: inline;"
                                *ngIf="((data['ATTACHED_PDF1']) && (data['ATTACHED_PDF1'] != ' '))">
                                &nbsp;

                                <span style="cursor: pointer;"
                                    (click)="viewAttachedFiles(data['ATTACHED_PDF1'], 'PDF')">
                                    <i nz-icon nzType="paper-clip" nzTheme="outline" style="font-size: 17px;"></i>

                                    <span style="font-size: 12px;">
                                        View File 1
                                    </span>
                                </span>
                            </div>

                            <div style="display: inline;"
                                *ngIf="((data['ATTACHED_PDF2']) && (data['ATTACHED_PDF2'] != ' '))">
                                &nbsp;

                                <span style="cursor: pointer;"
                                    (click)="viewAttachedFiles(data['ATTACHED_PDF2'], 'PDF')">
                                    <i nz-icon nzType="paper-clip" nzTheme="outline" style="font-size: 17px;"></i>

                                    <span style="font-size: 12px;">
                                        View File 2
                                    </span>
                                </span>
                            </div>

                            <div style="display: inline;"
                                *ngIf="((data['ATTACHED_PDF3']) && (data['ATTACHED_PDF3'] != ' '))">
                                &nbsp;

                                <span style="cursor: pointer;"
                                    (click)="viewAttachedFiles(data['ATTACHED_PDF3'], 'Image')">
                                    <i nz-icon nzType="paper-clip" nzTheme="outline" style="font-size: 17px;"></i>

                                    <span style="font-size: 12px;">
                                        View Image
                                    </span>
                                </span>
                            </div>

                            <div style="display: inline;"
                                *ngIf="(userID == data['CREATER_ID']) && (data['STATUS'] == 'P')">
                                &nbsp;

                                <span style="cursor: pointer;" (click)="sendMail(data)">
                                    <i nz-icon nzType="mail" nzTheme="outline" style="font-size: 17px;"></i>

                                    <span style="font-size: 12px;">
                                        Send Mail
                                    </span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div *ngIf="dataList.length == 0" style="margin-top: 20px">
            <nz-empty
                [nzNotFoundImage]="'https://gw.alipayobjects.com/mdn/miniapp_social/afts/img/A*pevERLJC9v0AAAAAAAAAAABjAQAAAQ/original'"
                [nzNotFoundContent]="contentTpl">
            </nz-empty>

            <ng-template #contentTpl>
                <span>No data available.</span>
            </ng-template>
        </div>
    </div>
</nz-spin>

<nz-modal nzWidth="1000px" [nzBodyStyle]="{height : '440px'}" [(nzVisible)]="DETAILSModalVisible"
    [nzTitle]="'Post Description'" [nzContent]="DETAILSModalContent" [nzFooter]="DETAILSModalFooter"
    (nzOnCancel)="photoModalCancel()" nzClosable="false">

    <ng-template #DETAILSModalContent>
        <div style="overflow-y: auto; height: 400px;">
            <p>{{DESCRIPTION1}}</p>
        </div>
    </ng-template>

    <ng-template #DETAILSModalFooter>
        <button nz-button nzType="default" (click)="DETAILSModalCancel()">Cancel</button>
    </ng-template>
</nz-modal>

<!-- Add new circular drawer -->
<nz-drawer [nzBodyStyle]="{height: 'calc(100% - 55px)', overflow: 'auto', 'padding-bottom': '53px'}"
    [nzClosable]="false" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="getwidth2()" [nzVisible]="drawerVisible"
    [nzTitle]="drawerTitle" (nzOnClose)="drawerClose()" (nzKeyboard)="true">

    <app-addcircular [isRemarkVisible]="isRemarkVisible" [memberData]="memberData" [drawerClose]="closeCallback"
        [drawerVisible]="drawerVisible" [data]="drawerData">
    </app-addcircular>
</nz-drawer>

<!-- View circular modal -->
<nz-modal [nzWidth]="getwidth()" [nzStyle]="{ top: '20px' }" [(nzVisible)]="isVisible" nzMaskClosable="false"
    nzClosable="false" [nzContent]="pdfModalContent" [nzTitle]="'Circular'" (nzOnCancel)="handleCancel()"
    [nzFooter]="pdfModalFooter">
    <ng-template #pdfModalContent>
        <nz-spin [nzSpinning]='loadingRecords'>
            <div style="height: 540px; overflow: auto;">
                <div id="modal">
                    <div style="width: 900px; padding: 3px; margin-left: 30px;">
                        <div
                            style="color:red; text-align: center; font-weight: bold; font-size: 22px; padding-bottom: 5px;">
                            {{federationInfo.NAME | uppercase}}
                        </div>

                        <div style="display: flex; border-bottom: 2px solid rgb(117, 117, 117); padding-bottom: 5px;">
                            <div style="width: 30%; padding: 3px;">
                                <div>
                                    <b
                                        style="color: #009cb8; font-weight: bold; text-transform: uppercase; margin-bottom: 1px; font-size: 14px;">
                                        {{memberData['NAME']}}
                                    </b>
                                </div>

                                <b style="font-size: 12px;">
                                    {{memberData.MEMBER_ROLE}}
                                    <br>
                                    HG : {{memberData.GROUP_NAME}}
                                    <br>
                                    {{memberData.ADDRESS1}} {{memberData.ADDRESS2}}
                                    <br>
                                    City : {{(memberData.CITY) ? (memberData.CITY.trim()) : ""}}{{(memberData.PINCODE) ?
                                    ('-' + memberData.PINCODE) : ""}}
                                    <br>
                                    <b style="font-weight: bold;">Mob</b> :
                                    {{memberData.MOBILE_NUMBER}}
                                    <br>
                                    <b style="font-weight: bold;">Email</b> :
                                    {{(memberData.EMAIL_ID) ? (memberData.EMAIL_ID.split(',')[0]) : ''}}
                                </b>
                            </div>

                            <div style="width: 40%; padding: 10px; text-align: center;">
                                <div>
                                    <img src="assets/demo.png" style="width: 80%; height: 120px;">
                                </div>

                                <div>
                                    <b style="color: red; font-weight: bold; font-size: 20px;">
                                        "Do Something Different"
                                    </b>
                                </div>
                            </div>

                            <div style="width: 30%; padding: 3px;">
                                <div *ngIf="dataList[currentIndex].LETTER_HEAD_ID != presidentInfo.ID">
                                    <div>
                                        <b
                                            style="color: #009cb8; font-weight: bold; text-transform: uppercase; margin-bottom: 1px; font-size: 14px;">
                                            {{presidentInfo.NAME}}
                                        </b>
                                    </div>

                                    <b style="font-weight: bold; font-size: 12px;">President,
                                        {{presidentInfo.FEDERATION_NAME}}
                                        <br>
                                        {{presidentInfo.ADDRESS1}} {{presidentInfo.ADDRESS2}}
                                        <br>
                                        City : {{(presidentInfo.CITY) ? (presidentInfo.CITY.trim()) :
                                        ""}}{{(presidentInfo.PINCODE) ? ('-' + presidentInfo.PINCODE) : ""}}
                                        <br>
                                        <b style="font-weight: bold;">Mob</b> :
                                        {{presidentInfo.MOBILE_NUMBER}}
                                        <br>
                                        <b style="font-weight: bold;">Email</b> :
                                        {{presidentInfo.EMAIL_ID ? presidentInfo.EMAIL_ID.split(',')[0] : ''}}
                                    </b>
                                </div>
                            </div>
                        </div>

                        <div class="row" style="border-top: 1px solid grey; margin-top: 1px; padding-top: 2px;">
                            <div style="text-align: end;">
                                {{dataList[currentIndex]['DATE'] | date: 'dd-MMM-yyyy'}}
                            </div>
                        </div>

                        <div style="text-align: center; font-size: 15px; color: black;">
                            <b>{{dataList[currentIndex]['SUBJECT']}}</b>
                        </div>

                        <div style="text-align: justify; word-break: break-all;"
                            [innerHTML]="dataList[currentIndex].DESCRIPTION">
                        </div>

                        <br>

                        <div>
                            <table style="width: 100%">
                                <td style="width: 32%;">
                                    <div style="text-align: center;" *ngIf="displaySigningAuth3Sign">
                                        <div *ngIf="GENDER3 != 'F'">
                                            <div>
                                                आपला स्नेहांकित,

                                                <br>

                                                <div *ngIf="(SIGNATURE3) && (SIGNATURE3 != ' ')">
                                                    <img src="{{RETRIVE_IMAGE_URL}}memberSignature/{{SIGNATURE3}}"
                                                        alt="img" style="width: 100px; height: 45px;">

                                                    <br>
                                                </div>

                                                <div *ngIf="(SIGNATURE3 == null) || (SIGNATURE3 == ' ')"
                                                    style="height: 45px;">

                                                    <br>
                                                </div>

                                                {{CREATOR_NAME3}}

                                                <br>

                                                <span *ngIf="ROLE3_FEDERATION_UNIT_GROUP != ''">
                                                    {{ROLE3_FEDERATION_UNIT_GROUP}}

                                                    <br>
                                                </span>

                                                ({{MEMBER_ROLE3}})
                                            </div>
                                        </div>

                                        <div *ngIf="(GENDER3 != '') && (GENDER3 != null) && (GENDER3 != 'M')">
                                            <div>
                                                आपली स्नेहांकित,

                                                <br>

                                                <div *ngIf="(SIGNATURE3) && (SIGNATURE3 != ' ')">
                                                    <img src="{{RETRIVE_IMAGE_URL}}memberSignature/{{SIGNATURE3}}"
                                                        alt="img" style="width: 100px; height: 45px;">

                                                    <br>
                                                </div>

                                                <div *ngIf="(SIGNATURE3 == null) || (SIGNATURE3 == ' ')"
                                                    style="height: 45px;">

                                                    <br>
                                                </div>

                                                {{CREATOR_NAME3}}

                                                <br>

                                                <span *ngIf="ROLE3_FEDERATION_UNIT_GROUP != ''">
                                                    {{ROLE3_FEDERATION_UNIT_GROUP}}

                                                    <br>
                                                </span>

                                                ({{MEMBER_ROLE3}})
                                            </div>
                                        </div>
                                    </div>
                                </td>

                                <td style="width: 32%;">
                                    <div style="text-align: center;" *ngIf="displaySigningAuth2Sign">
                                        <div *ngIf="GENDER2 != 'F'">
                                            <div>
                                                आपला स्नेहांकित,

                                                <br>

                                                <div *ngIf="(SIGNATURE2) && (SIGNATURE2 != ' ')">
                                                    <img src="{{RETRIVE_IMAGE_URL}}memberSignature/{{SIGNATURE2}}"
                                                        alt="img" style="width: 100px; height: 45px;">

                                                    <br>
                                                </div>

                                                <div *ngIf="(SIGNATURE2 == null) || (SIGNATURE2 == ' ')"
                                                    style="height: 45px;">

                                                    <br>
                                                </div>

                                                {{CREATOR_NAME2}}

                                                <br>

                                                <span *ngIf="ROLE2_FEDERATION_UNIT_GROUP != ''">
                                                    {{ROLE2_FEDERATION_UNIT_GROUP}}

                                                    <br>
                                                </span>

                                                ({{MEMBER_ROLE2}})
                                            </div>
                                        </div>

                                        <div *ngIf="(GENDER2 != null) && (GENDER2 != '') && (GENDER2 != 'M')">
                                            <div>
                                                आपली स्नेहांकित,

                                                <br>

                                                <div *ngIf="(SIGNATURE2) && (SIGNATURE2 != ' ')">
                                                    <img src="{{RETRIVE_IMAGE_URL}}memberSignature/{{SIGNATURE2}}"
                                                        alt="img" style="width: 100px; height: 45px;">

                                                    <br>
                                                </div>

                                                <div *ngIf="(SIGNATURE2 == null) || (SIGNATURE2 == ' ')"
                                                    style="height: 45px;">

                                                    <br>
                                                </div>

                                                {{CREATOR_NAME2}}

                                                <br>

                                                <span *ngIf="ROLE2_FEDERATION_UNIT_GROUP != ''">
                                                    {{ROLE2_FEDERATION_UNIT_GROUP}}

                                                    <br>
                                                </span>

                                                ({{MEMBER_ROLE2}})
                                            </div>
                                        </div>
                                    </div>
                                </td>

                                <td style="width: 32%;">
                                    <div style="text-align: center;">
                                        <div *ngIf="GENDER1 != 'F'">
                                            <div>
                                                आपला स्नेहांकित,

                                                <br>

                                                <div *ngIf="(SIGNATURE1) && (SIGNATURE1 != ' ')">
                                                    <img src="{{RETRIVE_IMAGE_URL}}memberSignature/{{SIGNATURE1}}"
                                                        alt="img" style="width: 100px; height: 45px;">

                                                    <br>
                                                </div>

                                                <div *ngIf="(SIGNATURE1 == null) || (SIGNATURE1 == ' ')"
                                                    style="height: 45px;">

                                                    <br>
                                                </div>

                                                {{CREATOR_NAME1}}

                                                <br>

                                                <span *ngIf="ROLE1_FEDERATION_UNIT_GROUP != ''">
                                                    {{ROLE1_FEDERATION_UNIT_GROUP}}

                                                    <br>
                                                </span>

                                                ({{MEMBER_ROLE1}})
                                            </div>
                                        </div>

                                        <div *ngIf="(GENDER1 != null) && (GENDER1 != '') && (GENDER1 != 'M')">
                                            <div>
                                                आपली स्नेहांकित,

                                                <br>

                                                <div *ngIf="(SIGNATURE1) && (SIGNATURE1 != ' ')">
                                                    <img src="{{RETRIVE_IMAGE_URL}}memberSignature/{{SIGNATURE1}}"
                                                        alt="img" style="width: 100px; height: 45px;">

                                                    <br>
                                                </div>

                                                <div *ngIf="(SIGNATURE1 == null) || (SIGNATURE1 == ' ')"
                                                    style="height: 45px;">

                                                    <br>
                                                </div>

                                                {{CREATOR_NAME1}}

                                                <br>

                                                <span *ngIf="ROLE1_FEDERATION_UNIT_GROUP != ''">
                                                    {{ROLE1_FEDERATION_UNIT_GROUP}}

                                                    <br>
                                                </span>

                                                ({{MEMBER_ROLE1}})
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </nz-spin>
    </ng-template>

    <ng-template #pdfModalFooter>
        <button nz-button nzType="default" (click)="handleCancel()">
            Close
        </button>

        <button nz-button nzType="primary" *ngIf="downloadBtn" printSectionId="modal" [useExistingCss]="true" ngxPrint>
            Print/ Save as PDF
        </button>
    </ng-template>
</nz-modal>

<!-- Email send drawer -->
<nz-drawer [nzBodyStyle]="{ height: 'calc(100% - 55px)', overflow: 'auto', 'padding-bottom': '53px' }"
    [nzClosable]="false" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="500"
    [nzVisible]="circularDrawerVisibleEmail" [nzTitle]="circularDrawerTitleEmail"
    (nzOnClose)="circularDrawerCloseEmail()" (nzKeyboard)="true">

    <app-circularemailsenderlist [drawerClose]="circularDrawerCloseEmailCallback"
        [drawerVisible]="circularDrawerCloseEmail" [data]="circularDrawerDataID">
    </app-circularemailsenderlist>
</nz-drawer>

<!-- View file/ image drawer -->
<nz-drawer [nzBodyStyle]="{ height: 'calc(100% - 55px)', overflow: 'auto', 'padding-bottom': '53px' }"
    [nzClosable]="true" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="1000" [nzVisible]="viewFileDrawerVisible"
    [nzTitle]="viewFileDrawerTitle" (nzOnClose)="viewFileDrawerClose()" (nzKeyboard)="true">

    <app-view-file-image-drawer [files]="attachedFiles" [sanitizedLink]="sanitizedLink"></app-view-file-image-drawer>
</nz-drawer>